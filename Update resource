@RequestMapping(value = "/updateResource", method = RequestMethod.POST)
public boolean updateResource(@RequestBody final Resource res) {

    Resource oldres = resourceService.findById1(res.getPsid());

    LocalDate oldEndDate = oldres.getEndDate();
    LocalDate newEndDate = res.getEndDate();

    int currYear = Calendar.getInstance().get(Calendar.YEAR);
    int currMonth = Calendar.getInstance().get(Calendar.MONTH);
    if (currMonth == 11) currYear++;

    // ---------------- REJOIN HANDLING START ----------------
    LocalDate today = LocalDate.now();
    if (oldEndDate.isBefore(today) && res.getStartDate().isAfter(oldEndDate)) {
        System.out.println("Detected rejoin for PSID: " + res.getPsid());

        int currentYear = today.getYear();
        int nextYear = currentYear + 1;

        BigDecimal one = BigDecimal.ONE;
        BigDecimal zero = BigDecimal.ZERO;

        // Restore availability for current & next year if missing
        if (!availabilityRepository.existsAllByAvailabilityId_AvailabilityYearAndAvailabilityId_Psid(currentYear, res.getPsid())) {
            AvailabilityCompositeId ac1 = new AvailabilityCompositeId(res.getPsid(), currentYear, res.getTeam());
            Availability availCurr = new Availability(ac1, one, one, one, one, one, one, one, one, one, one, one, one);
            resourceService.addAvailability(availCurr);
            System.out.println("Restored current year availability");
        }

        if (!availabilityRepository.existsAllByAvailabilityId_AvailabilityYearAndAvailabilityId_Psid(nextYear, res.getPsid())) {
            AvailabilityCompositeId ac2 = new AvailabilityCompositeId(res.getPsid(), nextYear, res.getTeam());
            Availability availNext = new Availability(ac2, one, one, one, one, one, one, one, one, one, one, one, one);
            resourceService.addAvailability(availNext);
            System.out.println("Restored next year availability");
        }

        // Restore holiday planners
        HolidayPlannerCompositeId hpCurr = new HolidayPlannerCompositeId(res.getPsid(), currentYear);
        HolidayPlannerCompositeId hpNext = new HolidayPlannerCompositeId(res.getPsid(), nextYear);

        if (!holidayPlannerRepository.existsById(hpCurr)) {
            holidayPlannerRepository.save(new HolidayPlanner(hpCurr,
                zero, zero, zero, zero, zero, zero, zero, zero, zero, zero, zero, zero));
            System.out.println("Restored current year holiday planner");
        }

        if (!holidayPlannerRepository.existsById(hpNext)) {
            holidayPlannerRepository.save(new HolidayPlanner(hpNext,
                zero, zero, zero, zero, zero, zero, zero, zero, zero, zero, zero, zero));
            System.out.println("Restored next year holiday planner");
        }
    }
    // ---------------- REJOIN HANDLING END ----------------

    //for postponement of end date
    if (newEndDate.isAfter(oldEndDate)) {
        // existing code (don’t touch)
    }
    else {
        // existing code (don’t touch)
    }

    arr1.updateResourceLog(oldres, res);
    arr.setCreated(this.resourceService.updateResource(res));
    return arr.isCreated();
}
