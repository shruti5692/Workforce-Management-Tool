@RequestMapping(value = "/updateResource", method = RequestMethod.POST)
public boolean updateResource(@RequestBody final Resource res) {

    boolean flag = false;
    AddResourceResponse arr = new AddResourceResponse();
    AddResourceResponse arr1 = new AddResourceResponse();

    Resource oldRes = resourceService.findById1(res.getPsid());
    LocalDate oldEndDate = oldRes.getEndDate();
    LocalDate newEndDate = res.getEndDate();
    LocalDate today = LocalDate.now();

    // ðŸŸ¢ Step 1: Detect Rejoin
    if (oldEndDate != null && oldEndDate.isBefore(today) && newEndDate.isAfter(today)) {
        // This line calls the helper you already have or we can define below
        handleRejoin(res);
    }

    // ðŸŸ¢ Step 2: Continue with existing postponement/preponement logic
    int currYear = Calendar.getInstance().get(Calendar.YEAR);
    int currMonth = Calendar.getInstance().get(Calendar.MONTH);
    if (currMonth == 11) currYear++;

    // ... (rest of your current code remains exactly same)
}


private void handleRejoin(Resource res) {
    int year = LocalDate.now().getYear();

    BigDecimal availVal = BigDecimal.ONE;
    BigDecimal zero = BigDecimal.ZERO;

    // âœ… Full availability for both years
    Availability availCurr = createFullAvailability(res, year, availVal);
    Availability availNext = createFullAvailability(res, year + 1, availVal);

    resourceService.addAvailability(availCurr);
    resourceService.addAvailability(availNext);

    // âœ… Reset holidays
    HolidayPlanner hpCurr = new HolidayPlanner(
        new HolidayPlannerCompositeId(res.getPsid(), year),
        zero, zero, zero, zero, zero, zero, zero, zero, zero, zero, zero, zero
    );
    holidayPlannerRepository.save(hpCurr);

    HolidayPlanner hpNext = new HolidayPlanner(
        new HolidayPlannerCompositeId(res.getPsid(), year + 1),
        zero, zero, zero, zero, zero, zero, zero, zero, zero, zero, zero, zero
    );
    holidayPlannerRepository.save(hpNext);

    // âœ… Log the rejoin
    ChangeLog log = getChangeLog("Resource rejoined: " + res.getPsid()
        + ", Name: " + res.getName()
        + ", Team: " + res.getTeam());
    resourceService.addResourceLog(log);
}
